@inject DialogService DialogService


<RadzenButton Icon="edit"
              Disabled="@IsDisabled"
              Size="ButtonSize.ExtraSmall"
              MouseEnter="@(args => AppTooltipService.ShowTooltip(args, $"Edit {nameof(RequirementsSpecification)}"))"
              MouseLeave="@AppTooltipService.HideTooltip"
              ButtonStyle="ButtonStyle.Light" Click="@EditInlineDialog" Style="color: green;"/>

@code {
    private RequirementsSpecification _requirements = new();

    [EditorRequired] [Parameter] public EventCallback OnRequirementSpecificationUpdated { get; set; }

    /// <summary>
    /// Default value is false
    /// </summary>
    [Parameter]
    public bool IsDisabled { get; set; } = false;

    [EditorRequired] [Parameter] public int Id { get; set; }


    private async Task UpdateNewRequirement()
    {
        // CreateBug should handle adding the bug and return a result
        _requirements = await RequirementsSpecificationModel.UpdateRequirementsSpecificationAsync(Id);
        DialogService.Close(_requirements);
        StateHasChanged();
        await FormNotificationService.NotifySuccess($"Requirement Updated successfully with id {_requirements.Id}");
        // Notify the parent that the requirement was created
        if (OnRequirementSpecificationUpdated.HasDelegate)
        {
            await OnRequirementSpecificationUpdated.InvokeAsync();
        }
    }


    async Task EditInlineDialog()
    {
        _requirements = await RequirementsSpecificationModel.GetRequirementsSpecificationByIdAsync(Id);

        var result = await DialogService.OpenAsync("Edit Requirement Specification", ds =>
            @<RadzenStack Gap="1.5rem" Style="height: 300px;">
                <RadzenTemplateForm Data="_requirements" TItem="RequirementsSpecification"
                                    Submit="@UpdateNewRequirement">
                    <ValidationSummary class="alert alert-danger"/>

                    <div class="form-group mb-4">
                        <RadzenLabel Text="Name"/>
                        <RadzenTextBox id="name"
                                       @bind-Value="_requirements.Name"
                                       class="input-style"
                                       Name="name"/>
                        <RadzenRequiredValidator Component="name" Text="Name is required"/>
                    </div>

                    <div class="form-group mb-4">
                        <RadzenLabel Text="Description"/>
                        <RadzenTextArea id="description"
                                        @bind-Value="_requirements.Description"
                                        class="input-style"
                                        Name="description"/>
                        <RadzenRequiredValidator Component="description" Text="Description is required"/>
                    </div>


                    <!-- Submit button inside the form -->
                    <RadzenButton Icon="update" Text="Requirements Specification" ButtonStyle="ButtonStyle.Warning"
                                  ButtonType="ButtonType.Submit"
                                  Style="margin-bottom: 10px;"/>
                </RadzenTemplateForm>
            </RadzenStack>, new DialogOptions() { Draggable = true, CloseDialogOnOverlayClick = true });
    }

}