@page "/integrations/create"
@attribute [Authorize]
@rendermode InteractiveServer
@inject ILogger<Create> Logger
@attribute [Authorize(Roles = "Admin , Manager")]

<AlertTitle TitleText="Creating New Integration"></AlertTitle>

<RadzenTemplateForm Data="_integrations" TItem="Integrations" Submit="CreateNewIntegration">
    <ValidationSummary class="alert alert-danger"/>

    <div class="form-group mb-4">
        <RadzenLabel Text="Base Url"/>
        <RadzenTextBox id="base-url"
                       @bind-Value="_integrations.BaseUrl"
                       class="input-style"
                       Name="name"/>
        <RadzenRequiredValidator Component="name" Text="Base URL is required"/>
    </div>

    <div class="form-group mb-4">
        <RadzenLabel Text="Username"/>
        <RadzenTextBox id="username"
                       @bind-Value="_integrations.Username"
                       class="input-style"
                       Name="name"/>
        <RadzenRequiredValidator Component="name" Text="Base URL is required"/>
    </div>

    <div class="form-group mb-4">
        <RadzenLabel Text="Api Key"/>
        <RadzenTextBox id="apikey"
                       @bind-Value="_integrations.ApiKey"
                       Placeholder="Put here your API KEY created from the integration provider"
                       class="input-style"
                       Name="apikey"/>
        <RadzenRequiredValidator Component="apikey" Text="API KEY is required"/>
    </div>
    
    <div class="form-group mb-4">
        <RadzenLabel Text="API Integration unique Key"/>
        <RadzenTextBox id="uniquekey"
                       @bind-Value="_integrations.UniqueKey"
                       Placeholder="Put here your unique string for example Jira-01"
                       class="input-style"
                       Name="uniquekey"/>
        <RadzenRequiredValidator Component="uniquekey" Text="Unique KEY is required"/>
    </div>

    <div class="form-group mb-4">
        <RadzenLabel Text="Integration Type"/>
        <RadzenDropDown id="integration-type"
                        @bind-Value="_integrations.IntegrationType"
                        Data="EnumService.GetEnumValues<IntegrationType>()"
                        class="input-style"
                        Name="integration-type"/>
        <RadzenRequiredValidator Component="integration-type" Text="Integration Type is required"/>
    </div>
    
    <div class="form-group mb-4">
        <RadzenLabel Text="Projects"/>
        <RadzenDropDown id="project-id"
                        @bind-Value="_integrations.ProjectsId"
                        Data="@_projectsList"
                        TextProperty="Name"
                        ValueProperty="Id"
                        class="input-style"
                        Name="project-id"/>
        <RadzenRequiredValidator Component="project-id" Text="Project is required"/>
    </div>


    <CreateEditActions EntityName="integrations" CreateEdit="Create"/>
</RadzenTemplateForm>


@code {
    private readonly Integrations _integrations = new();
    private List<Projects> _projectsList = [];

    protected override async Task OnInitializedAsync()
    {
        _projectsList = await ProjectModel.GetProjects();
    }


    private async Task CreateNewIntegration()
    {
        await IntegrationsModel.AddIntegration(_integrations);
        NavigationManager.NavigateTo("/integrations");
        await FormNotificationService.NotifySuccess("Integration Created Successfully");
    }


}